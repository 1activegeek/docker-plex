#!/usr/bin/with-contenv bash
# shellcheck shell=bash

umask "${UMASK}"

echo "
----------------------------------------------------------------------
ENVIRONMENT
----------------------------------------------------------------------
PUID=${PUID}
PGID=${PGID}
UMASK=${UMASK}
TZ=${TZ}
PLEX_CLAIM=${PLEX_CLAIM}
ADVERTISE_IP=${ADVERTISE_IP}
ALLOWED_NETWORKS=${ALLOWED_NETWORKS}
PLEX_PASS=${PLEX_PASS}
DISABLE_RELAY=${DISABLE_RELAY}
----------------------------------------------------------------------
"

groupmod -o -g "${PGID}" hotio

if [[ ! "${PUID}" -eq 0 ]]; then
    mkdir "/tmp/temphome"
    usermod -d "/tmp/temphome" hotio
fi
usermod -o -u "${PUID}" hotio
if [[ ! "${PUID}" -eq 0 ]]; then
    usermod -d "${CONFIG_DIR}" hotio
    rm -rf "/tmp/temphome"
fi

if [[ ! -d "${CONFIG_DIR}/app" ]]; then
    mkdir "${CONFIG_DIR}/app"
    chown hotio:hotio "${CONFIG_DIR}/app"
fi
